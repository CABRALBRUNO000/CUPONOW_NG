{
  "version": 3,
  "sources": ["../../../../../../node_modules/langchain/dist/chains/api/prompts.js", "../../../../../../node_modules/langchain/dist/chains/api/api_chain.js"],
  "sourcesContent": ["/* eslint-disable spaced-comment */\nimport { PromptTemplate } from \"@langchain/core/prompts\";\nexport const API_URL_RAW_PROMPT_TEMPLATE = `You are given the below API Documentation:\n{api_docs}\nUsing this documentation, generate the full API url to call for answering the user question.\nYou should build the API url in order to get a response that is as short as possible, while still getting the necessary information to answer the question. Pay attention to deliberately exclude any unnecessary pieces of data in the API call.\n\nQuestion:{question}\nAPI url:`;\nexport const API_URL_PROMPT_TEMPLATE = /* #__PURE__ */new PromptTemplate({\n  inputVariables: [\"api_docs\", \"question\"],\n  template: API_URL_RAW_PROMPT_TEMPLATE\n});\nexport const API_RESPONSE_RAW_PROMPT_TEMPLATE = `${API_URL_RAW_PROMPT_TEMPLATE} {api_url}\n\nHere is the response from the API:\n\n{api_response}\n\nSummarize this response to answer the original question.\n\nSummary:`;\nexport const API_RESPONSE_PROMPT_TEMPLATE = /* #__PURE__ */new PromptTemplate({\n  inputVariables: [\"api_docs\", \"question\", \"api_url\", \"api_response\"],\n  template: API_RESPONSE_RAW_PROMPT_TEMPLATE\n});", "import { BaseChain } from \"../base.js\";\nimport { LLMChain } from \"../llm_chain.js\";\nimport { API_URL_PROMPT_TEMPLATE, API_RESPONSE_PROMPT_TEMPLATE } from \"./prompts.js\";\n/**\n * Class that extends BaseChain and represents a chain specifically\n * designed for making API requests and processing API responses.\n */\nexport class APIChain extends BaseChain {\n  get inputKeys() {\n    return [this.inputKey];\n  }\n  get outputKeys() {\n    return [this.outputKey];\n  }\n  constructor(fields) {\n    super(fields);\n    Object.defineProperty(this, \"apiAnswerChain\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"apiRequestChain\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"apiDocs\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"headers\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, \"inputKey\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: \"question\"\n    });\n    Object.defineProperty(this, \"outputKey\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: \"output\"\n    });\n    this.apiRequestChain = fields.apiRequestChain;\n    this.apiAnswerChain = fields.apiAnswerChain;\n    this.apiDocs = fields.apiDocs;\n    this.inputKey = fields.inputKey ?? this.inputKey;\n    this.outputKey = fields.outputKey ?? this.outputKey;\n    this.headers = fields.headers ?? this.headers;\n  }\n  /** @ignore */\n  async _call(values, runManager) {\n    const question = values[this.inputKey];\n    const api_url = await this.apiRequestChain.predict({\n      question,\n      api_docs: this.apiDocs\n    }, runManager?.getChild(\"request\"));\n    const res = await fetch(api_url, {\n      headers: this.headers\n    });\n    const api_response = await res.text();\n    const answer = await this.apiAnswerChain.predict({\n      question,\n      api_docs: this.apiDocs,\n      api_url,\n      api_response\n    }, runManager?.getChild(\"response\"));\n    return {\n      [this.outputKey]: answer\n    };\n  }\n  _chainType() {\n    return \"api_chain\";\n  }\n  static async deserialize(data) {\n    const {\n      api_request_chain,\n      api_answer_chain,\n      api_docs\n    } = data;\n    if (!api_request_chain) {\n      throw new Error(\"LLMChain must have api_request_chain\");\n    }\n    if (!api_answer_chain) {\n      throw new Error(\"LLMChain must have api_answer_chain\");\n    }\n    if (!api_docs) {\n      throw new Error(\"LLMChain must have api_docs\");\n    }\n    return new APIChain({\n      apiAnswerChain: await LLMChain.deserialize(api_answer_chain),\n      apiRequestChain: await LLMChain.deserialize(api_request_chain),\n      apiDocs: api_docs\n    });\n  }\n  serialize() {\n    return {\n      _type: this._chainType(),\n      api_answer_chain: this.apiAnswerChain.serialize(),\n      api_request_chain: this.apiRequestChain.serialize(),\n      api_docs: this.apiDocs\n    };\n  }\n  /**\n   * Static method to create a new APIChain from a BaseLanguageModel and API\n   * documentation.\n   * @param llm BaseLanguageModel instance.\n   * @param apiDocs API documentation.\n   * @param options Optional configuration options for the APIChain.\n   * @returns New APIChain instance.\n   */\n  static fromLLMAndAPIDocs(llm, apiDocs, options = {}) {\n    const {\n      apiUrlPrompt = API_URL_PROMPT_TEMPLATE,\n      apiResponsePrompt = API_RESPONSE_PROMPT_TEMPLATE\n    } = options;\n    const apiRequestChain = new LLMChain({\n      prompt: apiUrlPrompt,\n      llm\n    });\n    const apiAnswerChain = new LLMChain({\n      prompt: apiResponsePrompt,\n      llm\n    });\n    return new this({\n      apiAnswerChain,\n      apiRequestChain,\n      apiDocs,\n      ...options\n    });\n  }\n}"],
  "mappings": ";;;;;;;;;;;;;;;AAEO,IAAM,8BAA8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOpC,IAAM,0BAAyC,IAAI,eAAe;AAAA,EACvE,gBAAgB,CAAC,YAAY,UAAU;AAAA,EACvC,UAAU;AACZ,CAAC;AACM,IAAM,mCAAmC,GAAG,2BAA2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASvE,IAAM,+BAA8C,IAAI,eAAe;AAAA,EAC5E,gBAAgB,CAAC,YAAY,YAAY,WAAW,cAAc;AAAA,EAClE,UAAU;AACZ,CAAC;;;AClBM,IAAM,WAAN,MAAM,kBAAiB,UAAU;AAAA,EACtC,IAAI,YAAY;AACd,WAAO,CAAC,KAAK,QAAQ;AAAA,EACvB;AAAA,EACA,IAAI,aAAa;AACf,WAAO,CAAC,KAAK,SAAS;AAAA,EACxB;AAAA,EACA,YAAY,QAAQ;AAClB,UAAM,MAAM;AACZ,WAAO,eAAe,MAAM,kBAAkB;AAAA,MAC5C,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU;AAAA,MACV,OAAO;AAAA,IACT,CAAC;AACD,WAAO,eAAe,MAAM,mBAAmB;AAAA,MAC7C,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU;AAAA,MACV,OAAO;AAAA,IACT,CAAC;AACD,WAAO,eAAe,MAAM,WAAW;AAAA,MACrC,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU;AAAA,MACV,OAAO;AAAA,IACT,CAAC;AACD,WAAO,eAAe,MAAM,WAAW;AAAA,MACrC,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU;AAAA,MACV,OAAO,CAAC;AAAA,IACV,CAAC;AACD,WAAO,eAAe,MAAM,YAAY;AAAA,MACtC,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU;AAAA,MACV,OAAO;AAAA,IACT,CAAC;AACD,WAAO,eAAe,MAAM,aAAa;AAAA,MACvC,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU;AAAA,MACV,OAAO;AAAA,IACT,CAAC;AACD,SAAK,kBAAkB,OAAO;AAC9B,SAAK,iBAAiB,OAAO;AAC7B,SAAK,UAAU,OAAO;AACtB,SAAK,WAAW,OAAO,YAAY,KAAK;AACxC,SAAK,YAAY,OAAO,aAAa,KAAK;AAC1C,SAAK,UAAU,OAAO,WAAW,KAAK;AAAA,EACxC;AAAA;AAAA,EAEM,MAAM,QAAQ,YAAY;AAAA;AAC9B,YAAM,WAAW,OAAO,KAAK,QAAQ;AACrC,YAAM,UAAU,MAAM,KAAK,gBAAgB,QAAQ;AAAA,QACjD;AAAA,QACA,UAAU,KAAK;AAAA,MACjB,GAAG,YAAY,SAAS,SAAS,CAAC;AAClC,YAAM,MAAM,MAAM,MAAM,SAAS;AAAA,QAC/B,SAAS,KAAK;AAAA,MAChB,CAAC;AACD,YAAM,eAAe,MAAM,IAAI,KAAK;AACpC,YAAM,SAAS,MAAM,KAAK,eAAe,QAAQ;AAAA,QAC/C;AAAA,QACA,UAAU,KAAK;AAAA,QACf;AAAA,QACA;AAAA,MACF,GAAG,YAAY,SAAS,UAAU,CAAC;AACnC,aAAO;AAAA,QACL,CAAC,KAAK,SAAS,GAAG;AAAA,MACpB;AAAA,IACF;AAAA;AAAA,EACA,aAAa;AACX,WAAO;AAAA,EACT;AAAA,EACA,OAAa,YAAY,MAAM;AAAA;AAC7B,YAAM;AAAA,QACJ;AAAA,QACA;AAAA,QACA;AAAA,MACF,IAAI;AACJ,UAAI,CAAC,mBAAmB;AACtB,cAAM,IAAI,MAAM,sCAAsC;AAAA,MACxD;AACA,UAAI,CAAC,kBAAkB;AACrB,cAAM,IAAI,MAAM,qCAAqC;AAAA,MACvD;AACA,UAAI,CAAC,UAAU;AACb,cAAM,IAAI,MAAM,6BAA6B;AAAA,MAC/C;AACA,aAAO,IAAI,UAAS;AAAA,QAClB,gBAAgB,MAAM,SAAS,YAAY,gBAAgB;AAAA,QAC3D,iBAAiB,MAAM,SAAS,YAAY,iBAAiB;AAAA,QAC7D,SAAS;AAAA,MACX,CAAC;AAAA,IACH;AAAA;AAAA,EACA,YAAY;AACV,WAAO;AAAA,MACL,OAAO,KAAK,WAAW;AAAA,MACvB,kBAAkB,KAAK,eAAe,UAAU;AAAA,MAChD,mBAAmB,KAAK,gBAAgB,UAAU;AAAA,MAClD,UAAU,KAAK;AAAA,IACjB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,OAAO,kBAAkB,KAAK,SAAS,UAAU,CAAC,GAAG;AACnD,UAAM;AAAA,MACJ,eAAe;AAAA,MACf,oBAAoB;AAAA,IACtB,IAAI;AACJ,UAAM,kBAAkB,IAAI,SAAS;AAAA,MACnC,QAAQ;AAAA,MACR;AAAA,IACF,CAAC;AACD,UAAM,iBAAiB,IAAI,SAAS;AAAA,MAClC,QAAQ;AAAA,MACR;AAAA,IACF,CAAC;AACD,WAAO,IAAI,KAAK;AAAA,MACd;AAAA,MACA;AAAA,MACA;AAAA,OACG,QACJ;AAAA,EACH;AACF;",
  "names": []
}
